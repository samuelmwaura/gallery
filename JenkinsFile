pipeline
{
    agent any
    tools
    {
        nodejs 'node'
    }
    stages
    {
        stage("Cloning the application repo from it's Github repository.")
        {
            steps
            {
                git branch:"master", url:"https://github.com/samuelmwaura/gallery.git"
            }
        }
        stage("Installing the dependencies and building the")
        {
            steps
            {
                sh "npm install"
            }
            
        }

        stage("Running the Application Tests")
        {
            steps
            {
                sh "npm test"
            }
        }

        stage("Deploying the Application to Render Platform.")
        {
            steps
            {
                curl -X POST "https://api.render.com/deploy/srv-d4qrtt7diees739g80r0?key=TsPNezNb1_I"
            }
        }
        
    }
    
    post 
    {
        success 
        {
            slackSend
            (
                channel: "samuel_ip1",
                color: 'good',
                message: 
                
                """
Build ${currentBuild.fullDisplayName} Completed Successfully
Build NUMBER: ${env.BUILD_NUMBER}
Status: ${currentBuild.currentResult}

Click here to got to site: https://gallery-tg7e.onrender.com """
)
    
}